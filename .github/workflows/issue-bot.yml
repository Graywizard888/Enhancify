name: Issue Auto Reply Bot

on:
  issues:
    types: [labeled]
  schedule:
    - cron: '0 0 * * 0'

permissions:
  issues: write
  contents: read

jobs:
  feature-request-reply:
    if: |
      github.event_name == 'issues' &&
      contains(github.event.issue.labels.*.name, 'enhancement')
    runs-on: ubuntu-latest
    steps:
      - name: Reply to Feature Request
        uses: peter-evans/create-or-update-comment@v5
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ## üî¨ Feature Request Detected !!
            
            Thanks for the feature request!
            
            The maintainer **@${{ github.repository_owner }}** is not available for now but will respond shortly...
            
            ### ‚úÖ Make sure you filled everything required info:
            - [ ] Clear description of the feature
            - [ ] Use case / Why you need this
            - [ ] Possible implementation ideas (optional)
            
            ---
            *This is an automated response*

  bug-report-reply:
    if: |
      github.event_name == 'issues' &&
      contains(github.event.issue.labels.*.name, 'bug')
    runs-on: ubuntu-latest
    steps:
      - name: Reply to Bug Report
        uses: peter-evans/create-or-update-comment@v5
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ## üêû Bug Report Detected !!
            
            Thanks for the bug report!
            
            The maintainer **@${{ github.repository_owner }}** is not available for now but will respond shortly...
            
            ### ‚úÖ Make sure you filled everything required info:
            - [ ] Steps to reproduce
            - [ ] Environment (OS, version, etc.)
            - [ ] Screenshots (if applicable)
            
            ---
            *This is an automated response*

  stale-issue-reminder:
    if: github.event_name == 'schedule'
    runs-on: ubuntu-latest
    steps:
      - name: Check and Comment on Old Issues
        uses: actions/github-script@v8
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            
            const issues = await github.rest.issues.listForRepo({
              owner,
              repo,
              state: 'open',
              per_page: 100
            });
            
            const fiveDaysAgo = new Date();
            fiveDaysAgo.setDate(fiveDaysAgo.getDate() - 5);
            
            for (const issue of issues.data) {
              if (issue.pull_request) continue;
              
              const createdAt = new Date(issue.created_at);
              
              if (createdAt < fiveDaysAgo) {
                const comments = await github.rest.issues.listComments({
                  owner,
                  repo,
                  issue_number: issue.number,
                  per_page: 10
                });
                
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                
                const alreadyNotified = comments.data.some(comment => {
                  const commentDate = new Date(comment.created_at);
                  return comment.body.includes('Looking Like This Issue Will Take Longer') &&
                         commentDate > oneWeekAgo;
                });
                
                if (!alreadyNotified) {
                  await github.rest.issues.createComment({
                    owner,
                    repo,
                    issue_number: issue.number,
                    body: `## ‚è≥ Looking Like This Issue Will Take Longer to Resolve - Stay Tuned !!
                    
            We appreciate your patience! This issue has been open for a while.
            
            **@${owner}** is working on addressing open issues.
            
            If you have any additional information that might help, please add it here.
            
            ---
            *This is an automated weekly reminder*`
                  });
                  
                  console.log(`Commented on issue #${issue.number}`);
                }
              }
            }
